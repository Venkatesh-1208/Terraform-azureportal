<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Azure Resource Deployment Portal</title>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@300;400;600&display=swap" rel="stylesheet">
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        :root {
            --primary-color: #6a63dd;
            --bg-color: #f0f2f5;
            --white: #ffffff;
            --text-color: #333;
            --border-color: #ccc;
            --highlight: #eef2ff;
            --success: #28a745;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--primary-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        #root {
            width: 100%;
            max-width: 1200px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .portal-header {
            background-color: var(--white);
            padding: 30px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header-title h1 {
            color: var(--primary-color);
            margin: 0 0 5px 0;
            font-weight: 300;
            font-size: 2rem;
        }

        .header-title p {
            margin: 0;
            color: #666;
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        .btn-action {
            padding: 8px 16px;
            border: 1px solid var(--primary-color);
            background: white;
            color: var(--primary-color);
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .btn-action:hover {
            background: var(--highlight);
        }

        .main-container {
            background-color: var(--white);
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .section-title {
            color: #333;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
            font-size: 0.9rem;
        }

        select,
        input[type="text"],
        input[type="number"],
        input[type="password"] {
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 1rem;
            width: 100%;
            box-sizing: border-box;
        }

        .panels-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .panel-row {
            display: flex;
            gap: 20px;
        }

        .panel {
            flex: 1;
            background-color: var(--highlight);
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .panel-header {
            background-color: #5c7cfa;
            color: white;
            padding: 15px;
            font-weight: 600;
        }

        .panel-body {
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .service-item {
            background: white;
            border-radius: 6px;
            border: 1px solid #ddd;
            overflow: hidden;
            transition: all 0.2s;
        }

        .service-item.active {
            border-color: var(--primary-color);
            box-shadow: 0 2px 8px rgba(106, 99, 221, 0.15);
        }

        .checkbox-header {
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            background-color: #fff;
        }

        .checkbox-header:hover {
            background-color: #f8f9fa;
        }

        .config-card {
            padding: 20px;
            background-color: #f8f9fa;
            border-top: 1px solid #eee;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .deploy-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 20px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }

        .btn-deploy {
            background-color: var(--primary-color);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            cursor: pointer;
            font-weight: 600;
        }

        .btn-deploy:hover {
            opacity: 0.9;
        }

        .global-context-bar {
            background: #e9ecef;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
        }

        .btn-apply {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
        }

        .btn-apply:hover {
            background-color: #218838;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const App = () => {
            // Global Context State
            const [globalContext, setGlobalContext] = useState({
                projectName: "myproject",
                environment: "Dev"
            });
            const fileInputRef = useRef(null);

            // Basic Config State
            const [subscription, setSubscription] = useState("");
            const [location, setLocation] = useState("East US");
            const [resourceGroup, setResourceGroup] = useState("");
            const [isNewRg, setIsNewRg] = useState(false);

            // IaaS Service Selection State
            const [iaasSelections, setIaasSelections] = useState({
                vm: false, vnet: false, storage: false, lb: false, nsg: false, publicIp: false
            });

            // IaaS Detailed Config State
            const [vmConfig, setVmConfig] = useState({ name: "", size: "Standard_B1s", username: "azureuser", password: "" });
            const [vnetConfig, setVnetConfig] = useState({ name: "", addressPrefix: "10.0.0.0/16", subnetName: "default", subnetPrefix: "10.0.0.0/24" });
            const [storageConfig, setStorageConfig] = useState({ name: "", type: "Standard_LRS" });
            const [lbConfig, setLbConfig] = useState({ name: "", sku: "Basic" });
            const [nsgConfig, setNsgConfig] = useState({ name: "" });
            const [pipConfig, setPipConfig] = useState({ name: "", allocation: "Dynamic" });

            // PaaS Service Selection State
            const [paasSelections, setPaasSelections] = useState({
                acr: false, linuxApp: false, windowsApp: false, funcApp: false
            });

            // PaaS Detailed Config State
            const [linuxAppConfig, setLinuxAppConfig] = useState({
                name: "",
                aspSelection: "new", // 'new' or 'existing'
                aspName: "",
                aspRg: "",
                sku: "B1",
                dockerImage: "nginx:latest",
                acrMode: "new",
                existingAcrName: "",
                enableSlot: false
            });
            const [acrConfig, setAcrConfig] = useState({ name: "", sku: "Basic" });
            const [windowsAppConfig, setWindowsAppConfig] = useState({ aspName: "", appName: "", sku: "F1" });
            const [funcAppConfig, setFuncAppConfig] = useState({ appName: "", aspName: "Consumption plan (auto-generated)", storageName: "", createCosmos: false, createOpenAI: false });

            // Database Selection State
            const [dbSelections, setDbSelections] = useState({ sql: false, postgres: false, cosmos: false });
            // Database Config State
            const [sqlConfig, setSqlConfig] = useState({ serverName: "", adminUser: "sqladminuser", adminPass: "", createDb: false });
            const [postgresConfig, setPostgresConfig] = useState({ serverName: "", sku: "B_Standard_B1ms", version: "14", adminUser: "pgadmin", adminPass: "", dbName: "" });
            const [cosmosConfig, setCosmosConfig] = useState({ name: "", api: "GlobalDocumentDB", consistency: "Session" });

            // Security Selection State
            const [secSelections, setSecSelections] = useState({ keyvault: false, aks: false });
            // Security Config State
            const [kvConfig, setKvConfig] = useState({ name: "", sku: "standard" });
            const [aksConfig, setAksConfig] = useState({
                name: "", environment: "Dev", nodeCount: "1", nodeSize: "Standard_B2s",
                enableAutoScale: false, minCount: "1", maxCount: "3", enableMonitoring: false
            });

            // Load Config Logic
            const handleLoadConfig = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const loaded = JSON.parse(e.target.result);

                        // Basic & Global
                        if (loaded.globalContext) setGlobalContext(loaded.globalContext);
                        setSubscription(loaded.subscription || "");
                        setLocation(loaded.location || "East US");
                        setResourceGroup(loaded.resourceGroup || "");
                        setIsNewRg(loaded.isNewRg || false);

                        // IaaS
                        if (loaded.iaasSelections) setIaasSelections(loaded.iaasSelections);
                        if (loaded.iaasConfig) {
                            setVmConfig(loaded.iaasConfig.vm);
                            setVnetConfig(loaded.iaasConfig.vnet);
                            setStorageConfig(loaded.iaasConfig.storage);
                            setLbConfig(loaded.iaasConfig.lb);
                            setNsgConfig(loaded.iaasConfig.nsg);
                            setPipConfig(loaded.iaasConfig.publicIp);
                        }

                        // PaaS
                        if (loaded.paasSelections) setPaasSelections(loaded.paasSelections);
                        if (loaded.paasConfig) {
                            setLinuxAppConfig(loaded.paasConfig.linuxApp);
                            setAcrConfig(loaded.paasConfig.acr);
                            setWindowsAppConfig(loaded.paasConfig.windowsApp);
                            setFuncAppConfig(loaded.paasConfig.funcApp);
                        }

                        // DB
                        if (loaded.dbSelections) setDbSelections(loaded.dbSelections);
                        if (loaded.dbConfig) {
                            setSqlConfig(loaded.dbConfig.sql);
                            setPostgresConfig(loaded.dbConfig.postgres);
                            setCosmosConfig(loaded.dbConfig.cosmos);
                        }

                        // Sec
                        if (loaded.secSelections) setSecSelections(loaded.secSelections);
                        if (loaded.secConfig) {
                            setKvConfig(loaded.secConfig.keyvault);
                            setAksConfig(loaded.secConfig.aks);
                        }

                        // Override AKS Env if Global Env is loaded? 
                        // It's better to let explicit AKS config override or sync individually.
                        // For now we just load what was saved.

                    } catch (err) {
                        alert("Error parsing config file: " + err.message);
                    }
                };
                reader.readAsText(file);
            };

            const handleSaveConfig = () => {
                const config = getFullConfig();
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(config, null, 2));
                const downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute("href", dataStr);
                downloadAnchorNode.setAttribute("download", `azure_config_${globalContext.projectName}_${globalContext.environment}.json`);
                document.body.appendChild(downloadAnchorNode);
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
            };

            // Apply Naming Convention
            const applyNaming = () => {
                const prefix = `${globalContext.projectName}-${globalContext.environment}`.toLowerCase().replace(/[^a-z0-9-]/g, '');
                const cleanPrefix = prefix.replace(/-/g, ''); // For storage accounts

                // IaaS
                setVmConfig(prev => ({ ...prev, name: `${prefix}-vm` }));
                setVnetConfig(prev => ({ ...prev, name: `${prefix}-vnet` }));
                setStorageConfig(prev => ({ ...prev, name: `${cleanPrefix}sa`.substring(0, 24) }));
                setLbConfig(prev => ({ ...prev, name: `${prefix}-lb` }));
                setNsgConfig(prev => ({ ...prev, name: `${prefix}-nsg` }));
                setPipConfig(prev => ({ ...prev, name: `${prefix}-pip` }));

                // PaaS
                setAcrConfig(prev => ({ ...prev, name: `${cleanPrefix}acr`.substring(0, 50) }));
                setLinuxAppConfig(prev => ({ ...prev, name: `${prefix}-app-linux` }));
                setWindowsAppConfig(prev => ({ ...prev, appName: `${prefix}-app-win`, aspName: `${prefix}-asp-win` }));
                setFuncAppConfig(prev => ({ ...prev, appName: `${prefix}-func`, storageName: `${cleanPrefix}funcsa`.substring(0, 24) }));

                // DB
                setSqlConfig(prev => ({ ...prev, serverName: `${prefix}-sql` }));
                setPostgresConfig(prev => ({ ...prev, serverName: `${prefix}-pg`, dbName: `${globalContext.projectName}_db` }));
                setCosmosConfig(prev => ({ ...prev, name: `${prefix}-cosmos` }));

                // Sec
                setKvConfig(prev => ({ ...prev, name: `${prefix}-kv` }));
                setAksConfig(prev => ({ ...prev, name: `${prefix}-aks`, environment: globalContext.environment })); // Sync AKS env too

                setResourceGroup(`${prefix}-rg`);
                setIsNewRg(true);
            };

            const getFullConfig = () => {
                return {
                    globalContext,
                    subscription, location, resourceGroup, isNewRg,
                    iaasSelections,
                    iaasConfig: {
                        vm: vmConfig, vnet: vnetConfig, storage: storageConfig,
                        lb: lbConfig, nsg: nsgConfig, publicIp: pipConfig
                    },
                    paasSelections,
                    paasConfig: {
                        linuxApp: {
                            ...linuxAppConfig,
                            // Map frontend state to terraform variable names if needed, 
                            // but we can just use the state object directly and map in TF vars file later 
                            // OR ensure frontend keys match expected JSON structure for TF.
                            // For simplicity, we pass the whole object.
                        },
                        acr: acrConfig,
                        windowsApp: windowsAppConfig, funcApp: funcAppConfig
                    },
                    dbSelections,
                    dbConfig: { sql: sqlConfig, postgres: postgresConfig, cosmos: cosmosConfig },
                    secSelections,
                    secConfig: { keyvault: kvConfig, aks: aksConfig },
                    tags: {
                        Project: globalContext.projectName,
                        Environment: globalContext.environment,
                        CreatedBy: "AzurePortal"
                    }
                };
            };

            const handleDeploy = () => {
                const config = getFullConfig();
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(config, null, 2));
                const downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute("href", dataStr);
                downloadAnchorNode.setAttribute("download", "deployment_config.json");
                document.body.appendChild(downloadAnchorNode);
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
            };

            // Handlers
            const handleIaasChange = (key) => setIaasSelections(prev => ({ ...prev, [key]: !prev[key] }));
            const handlePaasChange = (key) => setPaasSelections(prev => ({ ...prev, [key]: !prev[key] }));
            const handleDbChange = (key) => setDbSelections(prev => ({ ...prev, [key]: !prev[key] }));
            const handleSecChange = (key) => setSecSelections(prev => ({ ...prev, [key]: !prev[key] }));

            return (
                <div style={{ width: '100%', maxWidth: '1200px' }}>
                    <div className="portal-header">
                        <div className="header-title">
                            <h1>Azure Resource Deployment Portal</h1>
                            <p>Deploy and manage your Azure infrastructure</p>
                        </div>
                        <div className="header-actions">
                            <input type="file" ref={fileInputRef} style={{ display: 'none' }} onChange={handleLoadConfig} accept=".json" />
                            <button className="btn-action" onClick={() => fileInputRef.current.click()}>Load Config</button>
                            <button className="btn-action" onClick={handleSaveConfig}>Save Config</button>
                        </div>
                    </div>

                    <div className="main-container">

                        {/* Global Context Bar */}
                        <div className="global-context-bar">
                            <div className="form-row" style={{ alignItems: 'flex-end', margin: 0 }}>
                                <div className="form-group">
                                    <label>Project Name</label>
                                    <input type="text" value={globalContext.projectName} onChange={e => setGlobalContext({ ...globalContext, projectName: e.target.value })} placeholder="e.g. my-saas-app" />
                                </div>
                                <div className="form-group">
                                    <label>Global Environment</label>
                                    <select value={globalContext.environment} onChange={e => setGlobalContext({ ...globalContext, environment: e.target.value })}>
                                        <option value="Dev">Dev</option>
                                        <option value="Test">Test</option>
                                        <option value="Prod">Prod</option>
                                    </select>
                                </div>
                                <div className="form-group" style={{ flex: 0 }}>
                                    <button className="btn-apply" onClick={applyNaming}>Apply Naming Convention</button>
                                </div>
                            </div>
                            <small style={{ display: 'block', marginTop: '10px', color: '#666' }}>
                                Clicking "Apply" will auto-generate names for all resources based on <strong>{`{project}-{env}-{resource}`}</strong>.
                            </small>
                        </div>

                        {/* Basic Configuration */}
                        <div>
                            <h2 className="section-title">Basic Configuration</h2>
                            <div className="form-row">
                                <div className="form-group">
                                    <label>Subscription *</label>
                                    <select value={subscription} onChange={(e) => setSubscription(e.target.value)}>
                                        <option value="">Select Subscription...</option>
                                        <option value="sub-1">Free Trial (0000-0000-0000)</option>
                                        <option value="sub-2">Pay-As-You-Go (1111-1111-1111)</option>
                                    </select>
                                </div>
                                <div className="form-group">
                                    <label>Location</label>
                                    <select value={location} onChange={(e) => setLocation(e.target.value)}>
                                        <option value="East US">East US</option>
                                        <option value="West US">West US</option>
                                        <option value="North Europe">North Europe</option>
                                    </select>
                                </div>
                            </div>
                            <div className="form-group">
                                <label style={{ display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer', marginBottom: '10px' }}>
                                    <input type="checkbox" checked={isNewRg} onChange={(e) => setIsNewRg(e.target.checked)} />
                                    <span>Create New Resource Group</span>
                                </label>
                                <label>{isNewRg ? "New Resource Group Name" : "Existing Resource Group"}</label>
                                {isNewRg ? (
                                    <input type="text" placeholder="Enter name..." value={resourceGroup} onChange={(e) => setResourceGroup(e.target.value)} />
                                ) : (
                                    <select value={resourceGroup} onChange={(e) => setResourceGroup(e.target.value)}>
                                        <option value="">Select Resource Group...</option>
                                        <option value="rg-demo-1">rg-demo-1</option>
                                        <option value="rg-prod">rg-prod</option>
                                    </select>
                                )}
                            </div>
                        </div>

                        {/* Services Panels */}
                        <div className="panels-container">

                            <div className="panel-row">
                                {/* IaaS Panel */}
                                <div className="panel">
                                    <div className="panel-header">Infrastructure as a Service (IaaS)</div>
                                    <div className="panel-body">

                                        <ServiceCard label="Virtual Machines" checked={iaasSelections.vm} onToggle={() => handleIaasChange('vm')}>
                                            <div className="form-row">
                                                <div className="form-group">
                                                    <label>VM Name *</label>
                                                    <input type="text" placeholder="Enter VM name" value={vmConfig.name} onChange={e => setVmConfig({ ...vmConfig, name: e.target.value })} />
                                                </div>
                                                <div className="form-group">
                                                    <label>VM Size</label>
                                                    <select value={vmConfig.size} onChange={e => setVmConfig({ ...vmConfig, size: e.target.value })}>
                                                        <option value="Standard_B1s">Standard_B1s (1 vCPU, 1GB RAM)</option>
                                                        <option value="Standard_D2s_v3">Standard_D2s_v3 (2 vCPU, 8GB RAM)</option>
                                                        <option value="Standard_D4s_v3">Standard_D4s_v3 (4 vCPU, 16GB RAM)</option>
                                                        <option value="Standard_E2s_v3">Standard_E2s_v3 (2 vCPU, 16GB RAM)</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div className="form-row">
                                                <div className="form-group">
                                                    <label>Admin Username</label>
                                                    <input type="text" value={vmConfig.username} onChange={e => setVmConfig({ ...vmConfig, username: e.target.value })} />
                                                </div>
                                                <div className="form-group">
                                                    <label>Admin Password</label>
                                                    <input type="password" placeholder="Strong password required" value={vmConfig.password} onChange={e => setVmConfig({ ...vmConfig, password: e.target.value })} />
                                                </div>
                                            </div>
                                        </ServiceCard>

                                        <ServiceCard label="Virtual Network" checked={iaasSelections.vnet} onToggle={() => handleIaasChange('vnet')}>
                                            <div className="form-row">
                                                <div className="form-group">
                                                    <label>VNet Name *</label>
                                                    <input type="text" placeholder="Enter VNet name" value={vnetConfig.name} onChange={e => setVnetConfig({ ...vnetConfig, name: e.target.value })} />
                                                </div>
                                                <div className="form-group">
                                                    <label>Address Prefix</label>
                                                    <input type="text" value={vnetConfig.addressPrefix} onChange={e => setVnetConfig({ ...vnetConfig, addressPrefix: e.target.value })} />
                                                </div>
                                            </div>
                                            <div className="form-row">
                                                <div className="form-group">
                                                    <label>Subnet Name</label>
                                                    <input type="text" value={vnetConfig.subnetName} onChange={e => setVnetConfig({ ...vnetConfig, subnetName: e.target.value })} />
                                                </div>
                                                <div className="form-group">
                                                    <label>Subnet Prefix</label>
                                                    <input type="text" value={vnetConfig.subnetPrefix} onChange={e => setVnetConfig({ ...vnetConfig, subnetPrefix: e.target.value })} />
                                                </div>
                                            </div>
                                        </ServiceCard>

                                        <ServiceCard label="Storage Account" checked={iaasSelections.storage} onToggle={() => handleIaasChange('storage')}>
                                            <div className="form-row">
                                                <div className="form-group">
                                                    <label>Storage Account Name *</label>
                                                    <input type="text" placeholder="Enter storage name" value={storageConfig.name} onChange={e => setStorageConfig({ ...storageConfig, name: e.target.value })} />
                                                    <small style={{ color: '#666', fontSize: '0.8rem' }}>Must be globally unique, 3-24 characters, lowercase letters and numbers only</small>
                                                </div>
                                                <div className="form-group">
                                                    <label>Account Type</label>
                                                    <select value={storageConfig.type} onChange={e => setStorageConfig({ ...storageConfig, type: e.target.value })}>
                                                        <option value="Standard_LRS">Standard LRS</option>
                                                        <option value="Standard_GRS">Standard GRS</option>
                                                        <option value="Standard_ZRS">Standard ZRS</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </ServiceCard>

                                        <ServiceCard label="Load Balancer" checked={iaasSelections.lb} onToggle={() => handleIaasChange('lb')}>
                                            <div className="form-row">
                                                <div className="form-group">
                                                    <label>Load Balancer Name *</label>
                                                    <input type="text" placeholder="Enter load balancer name" value={lbConfig.name} onChange={e => setLbConfig({ ...lbConfig, name: e.target.value })} />
                                                </div>
                                                <div className="form-group">
                                                    <label>Load Balancer Type</label>
                                                    <select value={lbConfig.sku} onChange={e => setLbConfig({ ...lbConfig, sku: e.target.value })}>
                                                        <option value="Basic">Basic</option>
                                                        <option value="Standard">Standard</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </ServiceCard>

                                        <ServiceCard label="Network Security Group" checked={iaasSelections.nsg} onToggle={() => handleIaasChange('nsg')}>
                                            <div className="form-group">
                                                <label>NSG Name *</label>
                                                <input type="text" placeholder="Enter NSG name" value={nsgConfig.name} onChange={e => setNsgConfig({ ...nsgConfig, name: e.target.value })} />
                                            </div>
                                        </ServiceCard>

                                        <ServiceCard label="Public IP Address" checked={iaasSelections.publicIp} onToggle={() => handleIaasChange('publicIp')}>
                                            <div className="form-row">
                                                <div className="form-group">
                                                    <label>Public IP Name *</label>
                                                    <input type="text" placeholder="Enter public IP name" value={pipConfig.name} onChange={e => setPipConfig({ ...pipConfig, name: e.target.value })} />
                                                </div>
                                                <div className="form-group">
                                                    <label>Allocation Method</label>
                                                    <select value={pipConfig.allocation} onChange={e => setPipConfig({ ...pipConfig, allocation: e.target.value })}>
                                                        <option value="Dynamic">Dynamic</option>
                                                        <option value="Static">Static</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </ServiceCard>
                                    </div>
                                </div>

                                {/* PaaS Panel */}
                                <div className="panel">
                                    <div className="panel-header">Platform as a Service (PaaS)</div>
                                    <div className="panel-body">

                                        <ServiceCard label="Azure Container Registry" checked={paasSelections.acr} onToggle={() => handlePaasChange('acr')}>
                                            <div className="form-row">
                                                <div className="form-group">
                                                    <label>Registry Name *</label>
                                                    <input type="text" placeholder="acrregistryname" value={acrConfig.name} onChange={e => setAcrConfig({ ...acrConfig, name: e.target.value })} />
                                                </div>
                                                <div className="form-group">
                                                    <label>SKU</label>
                                                    <select value={acrConfig.sku} onChange={e => setAcrConfig({ ...acrConfig, sku: e.target.value })}>
                                                        <option value="Basic">Basic</option>
                                                        <option value="Standard">Standard</option>
                                                        <option value="Premium">Premium</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </ServiceCard>

                                        <ServiceCard label="Linux App Service with Container" checked={paasSelections.linuxApp} onToggle={() => handlePaasChange('linuxApp')}>
                                            <div className="form-row">
                                                <div className="form-group">
                                                    <label>App Service Name *</label>
                                                    <input type="text" placeholder="Enter app service name" value={linuxAppConfig.name} onChange={(e) => setLinuxAppConfig({ ...linuxAppConfig, name: e.target.value })} />
                                                </div>
                                                <div className="form-group">
                                                    <label>App Service Plan Name *</label>
                                                    <input type="text" placeholder="Enter ASP name" value={linuxAppConfig.aspName} onChange={(e) => setLinuxAppConfig({ ...linuxAppConfig, aspName: e.target.value })} />
                                                </div>
                                            </div>

                                            <div className="form-group" style={{ marginBottom: '15px' }}>
                                                <div style={{ display: 'flex', gap: '20px', marginBottom: '5px' }}>
                                                    <label style={{ fontWeight: 'normal', cursor: 'pointer' }}>
                                                        <input type="radio" name="aspSelection" checked={linuxAppConfig.aspSelection === 'new'} onChange={() => setLinuxAppConfig({ ...linuxAppConfig, aspSelection: 'new' })} /> Create New ASP
                                                    </label>
                                                    <label style={{ fontWeight: 'normal', cursor: 'pointer' }}>
                                                        <input type="radio" name="aspSelection" checked={linuxAppConfig.aspSelection === 'existing'} onChange={() => setLinuxAppConfig({ ...linuxAppConfig, aspSelection: 'existing' })} /> Use Existing ASP
                                                    </label>
                                                </div>
                                                {linuxAppConfig.aspSelection === 'existing' && (
                                                    <input type="text" placeholder="Existing ASP Resource Group (Leave empty if same)" value={linuxAppConfig.aspRg} onChange={(e) => setLinuxAppConfig({ ...linuxAppConfig, aspRg: e.target.value })} style={{ marginTop: '5px' }} />
                                                )}
                                            </div>

                                            <div className="form-row">
                                                <div className="form-group">
                                                    <label>App Service Plan SKU</label>
                                                    <select value={linuxAppConfig.sku} onChange={(e) => setLinuxAppConfig({ ...linuxAppConfig, sku: e.target.value })} disabled={linuxAppConfig.aspSelection === 'existing'}>
                                                        <option value="B1">B1 (Basic - $13/mo)</option>
                                                        <option value="B2">B2 (Basic - $26/mo)</option>
                                                        <option value="B3">B3 (Basic - $52/mo)</option>
                                                        <option value="S1">S1 (Standard - $73/mo)</option>
                                                        <option value="S2">S2 (Standard - $146/mo)</option>
                                                        <option value="S3">S3 (Standard - $219/mo)</option>
                                                        <option value="P1v2">P1v2 (Premium - $146/mo)</option>
                                                        <option value="P2v2">P2v2 (Premium - $292/mo)</option>
                                                        <option value="P3v2">P3v2 (Premium - $584/mo)</option>
                                                    </select>
                                                </div>
                                                <div className="form-group">
                                                    <label>Docker Image</label>
                                                    <input type="text" placeholder="myapp:latest or nginx:latest" value={linuxAppConfig.dockerImage} onChange={(e) => setLinuxAppConfig({ ...linuxAppConfig, dockerImage: e.target.value })} />
                                                </div>
                                            </div>

                                            <div style={{ border: '1px solid #ffc107', borderRadius: '4px', padding: '15px', background: '#fffcf5', marginBottom: '15px' }}>
                                                <h4 style={{ marginTop: 0, marginBottom: '10px', fontSize: '0.9rem', color: '#333' }}>Existing ACR Configuration</h4>
                                                <div className="form-row">
                                                    <div className="form-group">
                                                        <label>Container Registry Mode</label>
                                                        <select value={linuxAppConfig.acrMode} onChange={(e) => setLinuxAppConfig({ ...linuxAppConfig, acrMode: e.target.value })}>
                                                            <option value="new">Create New ACR (Detailed above)</option>
                                                            <option value="existing">Use Existing ACR</option>
                                                            <option value="none">None / Public Image</option>
                                                        </select>
                                                    </div>
                                                    {linuxAppConfig.acrMode === 'existing' && (
                                                        <div className="form-group">
                                                            <label>Existing ACR Name</label>
                                                            <input type="text" placeholder="myregistry" value={linuxAppConfig.existingAcrName} onChange={(e) => setLinuxAppConfig({ ...linuxAppConfig, existingAcrName: e.target.value })} />
                                                        </div>
                                                    )}
                                                </div>
                                            </div>

                                            <div>
                                                <label style={{ display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer' }}>
                                                    <input type="checkbox" checked={linuxAppConfig.enableSlot} onChange={(e) => setLinuxAppConfig({ ...linuxAppConfig, enableSlot: e.target.checked })} />
                                                    <span>Create Deployment Slot (Blue-Green)</span>
                                                </label>
                                            </div>
                                        </ServiceCard>

                                        <ServiceCard label="Windows App Service" checked={paasSelections.windowsApp} onToggle={() => handlePaasChange('windowsApp')}>
                                            <div className="form-row">
                                                <div className="form-group">
                                                    <label>App Service Plan Name *</label>
                                                    <input type="text" placeholder="Enter ASP name" value={windowsAppConfig.aspName} onChange={e => setWindowsAppConfig({ ...windowsAppConfig, aspName: e.target.value })} />
                                                </div>
                                                <div className="form-group">
                                                    <label>Web App Name *</label>
                                                    <input type="text" placeholder="Enter web app name" value={windowsAppConfig.appName} onChange={e => setWindowsAppConfig({ ...windowsAppConfig, appName: e.target.value })} />
                                                </div>
                                            </div>
                                            <div className="form-group">
                                                <label>App Service Plan SKU</label>
                                                <select value={windowsAppConfig.sku} onChange={e => setWindowsAppConfig({ ...windowsAppConfig, sku: e.target.value })}>
                                                    <option value="F1">F1 (Free)</option>
                                                    <option value="B1">B1 (Basic)</option>
                                                    <option value="S1">S1 (Standard)</option>
                                                    <option value="P1v2">P1v2 (Premium)</option>
                                                </select>
                                            </div>
                                        </ServiceCard>

                                        <ServiceCard label="Function App with AI Integration" checked={paasSelections.funcApp} onToggle={() => handlePaasChange('funcApp')}>
                                            <div className="form-row">
                                                <div className="form-group">
                                                    <label>Function App Name *</label>
                                                    <input type="text" placeholder="Enter function app name" value={funcAppConfig.appName} onChange={e => setFuncAppConfig({ ...funcAppConfig, appName: e.target.value })} />
                                                </div>
                                                <div className="form-group">
                                                    <label>App Service Plan Name</label>
                                                    <input type="text" disabled value={funcAppConfig.aspName} />
                                                </div>
                                            </div>
                                            <div className="form-group">
                                                <label>Storage Account Name *</label>
                                                <input type="text" placeholder="Enter storage name for function" value={funcAppConfig.storageName} onChange={e => setFuncAppConfig({ ...funcAppConfig, storageName: e.target.value })} />
                                            </div>
                                            <div style={{ marginTop: '15px' }}>
                                                <label style={{ display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer', marginBottom: '10px' }}>
                                                    <input type="checkbox" checked={funcAppConfig.createCosmos} onChange={(e) => setFuncAppConfig({ ...funcAppConfig, createCosmos: e.target.checked })} />
                                                    <span>Create Cosmos DB for Function</span>
                                                </label>
                                                <label style={{ display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer' }}>
                                                    <input type="checkbox" checked={funcAppConfig.createOpenAI} onChange={(e) => setFuncAppConfig({ ...funcAppConfig, createOpenAI: e.target.checked })} />
                                                    <span>Create Cognitive Services/OpenAI</span>
                                                </label>
                                            </div>
                                        </ServiceCard>
                                    </div>
                                </div>
                            </div>

                            <div className="panel-row">
                                {/* Database Panel */}
                                <div className="panel">
                                    <div className="panel-header">Database Services</div>
                                    <div className="panel-body">
                                        <ServiceCard label="SQL Server & Database" checked={dbSelections.sql} onToggle={() => handleDbChange('sql')}>
                                            <div className="form-row">
                                                <div className="form-group">
                                                    <label>SQL Server Name *</label>
                                                    <input type="text" placeholder="Enter SQL server name" value={sqlConfig.serverName} onChange={e => setSqlConfig({ ...sqlConfig, serverName: e.target.value })} />
                                                </div>
                                                <div className="form-group">
                                                    <label>Admin Username *</label>
                                                    <input type="text" value={sqlConfig.adminUser} onChange={e => setSqlConfig({ ...sqlConfig, adminUser: e.target.value })} />
                                                </div>
                                            </div>
                                            <div className="form-group">
                                                <label>Admin Password *</label>
                                                <input type="password" placeholder="Strong password required" value={sqlConfig.adminPass} onChange={e => setSqlConfig({ ...sqlConfig, adminPass: e.target.value })} />
                                                <small style={{ color: '#666', fontSize: '0.75rem' }}>Must contain uppercase, lowercase, number, and special character</small>
                                            </div>
                                            <div style={{ marginTop: '15px' }}>
                                                <label style={{ display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer' }}>
                                                    <input type="checkbox" checked={sqlConfig.createDb} onChange={(e) => setSqlConfig({ ...sqlConfig, createDb: e.target.checked })} />
                                                    <span>Create Database</span>
                                                </label>
                                            </div>
                                        </ServiceCard>

                                        <ServiceCard label="PostgreSQL Flexible Server" checked={dbSelections.postgres} onToggle={() => handleDbChange('postgres')}>
                                            <div className="form-row">
                                                <div className="form-group">
                                                    <label>PostgreSQL Server Name *</label>
                                                    <input type="text" placeholder="Enter PostgreSQL server name" value={postgresConfig.serverName} onChange={e => setPostgresConfig({ ...postgresConfig, serverName: e.target.value })} />
                                                </div>
                                                <div className="form-group">
                                                    <label>PostgreSQL SKU</label>
                                                    <select value={postgresConfig.sku} onChange={e => setPostgresConfig({ ...postgresConfig, sku: e.target.value })}>
                                                        <option value="B_Standard_B1ms">Burstable - B1ms (1 vCore, 2GB RAM)</option>
                                                        <option value="GP_Standard_D2s_v3">General Purpose - D2s_v3</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div className="form-row">
                                                <div className="form-group">
                                                    <label>PostgreSQL Version</label>
                                                    <select value={postgresConfig.version} onChange={e => setPostgresConfig({ ...postgresConfig, version: e.target.value })}>
                                                        <option value="14">PostgreSQL 14</option>
                                                        <option value="13">PostgreSQL 13</option>
                                                    </select>
                                                </div>
                                                <div className="form-group">
                                                    <label>Admin Username *</label>
                                                    <input type="text" value={postgresConfig.adminUser} onChange={e => setPostgresConfig({ ...postgresConfig, adminUser: e.target.value })} />
                                                </div>
                                            </div>
                                            <div className="form-row">
                                                <div className="form-group">
                                                    <label>Admin Password *</label>
                                                    <input type="password" placeholder="Strong password required" value={postgresConfig.adminPass} onChange={e => setPostgresConfig({ ...postgresConfig, adminPass: e.target.value })} />
                                                </div>
                                                <div className="form-group">
                                                    <label>Database Name</label>
                                                    <input type="text" placeholder="Enter database name" value={postgresConfig.dbName} onChange={e => setPostgresConfig({ ...postgresConfig, dbName: e.target.value })} />
                                                </div>
                                            </div>
                                        </ServiceCard>

                                        <ServiceCard label="Cosmos DB" checked={dbSelections.cosmos} onToggle={() => handleDbChange('cosmos')}>
                                            <div className="form-row">
                                                <div className="form-group">
                                                    <label>Cosmos DB Account Name *</label>
                                                    <input type="text" placeholder="Enter Cosmos DB name" value={cosmosConfig.name} onChange={e => setCosmosConfig({ ...cosmosConfig, name: e.target.value })} />
                                                </div>
                                                <div className="form-group">
                                                    <label>API Type</label>
                                                    <select value={cosmosConfig.api} onChange={e => setCosmosConfig({ ...cosmosConfig, api: e.target.value })}>
                                                        <option value="GlobalDocumentDB">SQL (Core)</option>
                                                        <option value="MongoDB">MongoDB</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div className="form-group">
                                                <label>Consistency Level</label>
                                                <select value={cosmosConfig.consistency} onChange={e => setCosmosConfig({ ...cosmosConfig, consistency: e.target.value })}>
                                                    <option value="Session">Session (Recommended)</option>
                                                    <option value="Strong">Strong</option>
                                                    <option value="Eventual">Eventual</option>
                                                </select>
                                            </div>
                                        </ServiceCard>
                                    </div>
                                </div>

                                {/* Security Panel */}
                                <div className="panel">
                                    <div className="panel-header">Security & Management Services</div>
                                    <div className="panel-body">
                                        <ServiceCard label="Key Vault" checked={secSelections.keyvault} onToggle={() => handleSecChange('keyvault')}>
                                            <div className="form-row">
                                                <div className="form-group">
                                                    <label>Key Vault Name *</label>
                                                    <input type="text" placeholder="Enter key vault name" value={kvConfig.name} onChange={e => setKvConfig({ ...kvConfig, name: e.target.value })} />
                                                </div>
                                                <div className="form-group">
                                                    <label>Key Vault SKU</label>
                                                    <select value={kvConfig.sku} onChange={e => setKvConfig({ ...kvConfig, sku: e.target.value })}>
                                                        <option value="standard">Standard - $0.03 per 10K operations</option>
                                                        <option value="premium">Premium</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </ServiceCard>

                                        <ServiceCard label="Azure Kubernetes Service (AKS)" checked={secSelections.aks} onToggle={() => handleSecChange('aks')}>
                                            <div className="form-row">
                                                <div className="form-group">
                                                    <label>Environment</label>
                                                    <select value={aksConfig.environment} onChange={e => setAksConfig({ ...aksConfig, environment: e.target.value })}>
                                                        <option value="Dev">Dev (1 node, B2s, No Autoscale)</option>
                                                        <option value="Test">Test (1-3 nodes, D2s, Autoscale)</option>
                                                        <option value="Prod">Prod (3-5 nodes, D2s, Autoscale + Monitor)</option>
                                                    </select>
                                                </div>
                                                <div className="form-group">
                                                    <label>AKS Cluster Name *</label>
                                                    <input type="text" placeholder="Enter AKS cluster name" value={aksConfig.name} onChange={e => setAksConfig({ ...aksConfig, name: e.target.value })} />
                                                </div>
                                            </div>
                                            <div className="form-row">
                                                <div className="form-group">
                                                    <label>Node Size</label>
                                                    <select value={aksConfig.nodeSize} onChange={e => setAksConfig({ ...aksConfig, nodeSize: e.target.value })}>
                                                        <option value="Standard_D2s_v3">Standard_D2s_v3 (2 vCPU, 8GB) - ~$73/node/month</option>
                                                        <option value="Standard_B2s">Standard_B2s (2 vCPU, 4GB) - ~$30/node/month</option>
                                                    </select>
                                                </div>
                                                <div className="form-group">
                                                    <label style={{ display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer', marginBottom: '5px', marginTop: '5px' }}>
                                                        <input type="checkbox" checked={aksConfig.enableAutoScale} onChange={e => setAksConfig({ ...aksConfig, enableAutoScale: e.target.checked })} />
                                                        <span>Enable Auto-scaling</span>
                                                    </label>

                                                    {!aksConfig.enableAutoScale ? (
                                                        <input type="number" min="1" value={aksConfig.nodeCount} onChange={e => setAksConfig({ ...aksConfig, nodeCount: e.target.value })} placeholder="Node Count" />
                                                    ) : (
                                                        <div style={{ display: 'flex', gap: '10px' }}>
                                                            <input type="number" min="1" value={aksConfig.minCount} onChange={e => setAksConfig({ ...aksConfig, minCount: e.target.value })} placeholder="Min" title="Min Nodes" />
                                                            <input type="number" min="1" value={aksConfig.maxCount} onChange={e => setAksConfig({ ...aksConfig, maxCount: e.target.value })} placeholder="Max" title="Max Nodes" />
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                            <div>
                                                <label style={{ display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer' }}>
                                                    <input type="checkbox" checked={aksConfig.enableMonitoring} onChange={e => setAksConfig({ ...aksConfig, enableMonitoring: e.target.checked })} />
                                                    <span>Enable Container Monitoring</span>
                                                </label>
                                            </div>
                                        </ServiceCard>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <div className="deploy-actions">
                            <button className="btn-deploy" onClick={handleDeploy}>Review + Create</button>
                        </div>
                    </div>
                </div>
            );
        };

        const ServiceCard = ({ label, checked, onToggle, children }) => (
            <div className={`service-item ${checked ? 'active' : ''}`}>
                <div className="checkbox-header" onClick={onToggle}>
                    <input type="checkbox" checked={checked} readOnly />
                    <span style={{ fontWeight: 500 }}>{label}</span>
                </div>
                {checked && (
                    <div className="config-card">
                        {children}
                    </div>
                )}
            </div>
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>